<html>
 <head>
     <title>Proyecto final - WebGL</title>  
 </head>
 <body>
    <h1 style="text-align: center;">Final Project</h1>
    <div id="container" style="width:95%; height:80%; position:absolute"></div>
    <script type="module">
        import * as THREE from './build/three.module.js';

        import { GLTFLoader } from './loaders/GLTFLoader.js';

        var renderer = null,
        scene = null,
        camera = null,
        rootNode = null,
        animating = false;

        init();
    
        function init() {
            // x: left - right
            // y: up - down
            // z: front - back
            var container = document.getElementById("container");
    
            renderer = new THREE.WebGLRenderer({antialias: true});
            renderer.setSize(container.offsetWidth, container.offsetHeight);
            container.appendChild(renderer.domElement);
    
            scene = new THREE.Scene();
            scene.background = new THREE.Color( 0x8fbfff );

            camera = new THREE.PerspectiveCamera( 45, container.offsetWidth / container.offsetHeight,
                    1, 4000);
            camera.position.set(0, 9, 14);
            camera.rotation.x = -Math.PI / 5;
            
            rootNode = new THREE.Object3D();

            var light = new THREE.DirectionalLight(0xffffff, 2.5);
            light.position.set(5, 5, 3);
            rootNode.add(light);

            /*
            var mapURL = "./tex_img.jpg";
            map = THREE.ImageUtils.loadTexture(mapURL);
            var material = new THREE.MeshPhongMaterial({map: map});
            */

            loadMultipleModels(rootNode, 'Sheep.glb', 0.1, [[1,1], [2,2], [-1, 3]]);
            loadMultipleModels(rootNode, 'Pig.glb', 0.1, [[-1,1], [-2,2], [1, 3]]);
            loadMultipleModels(rootNode, 'Tree.glb', 0.2, [[6,4], [-3,-4], [-3, 4.5]]);
            loadMultipleModels(rootNode, 'Tree3.glb', 0.2, [[-5.5,-4.5], [2.5,-2.5], [3, 4.5]]);
            loadCloudModels(rootNode, 'cloud.glb', 0.2, [[-5.5,-4.5], [2.5,-2.5], [3, 4.5], [-5, 3.5]]);
            
           /*  loader.load( 'Wolf.glb', function ( gltf ) {
                let sheepNode = new THREE.Object3D();
                sheepNode.add(gltf.scene);
                sheepNode.scale.set(0.1, 0.1, 0.1);
                sheepNode.position.set(2,0.5,0);
                rootNode.add(sheepNode);
            } ); */

            var grassMaterial = new THREE.MeshPhongMaterial({color:0x009911});
            var grassGeometry = new THREE.CubeGeometry(15, 0.1, 15);
            var grass = new THREE.Mesh(grassGeometry, grassMaterial);
            grass.position.set(0, 0, 0)
            rootNode.add(grass);

            var barnMaterial = new THREE.MeshPhongMaterial({color:0xaa0000});
            var barnGeometry = new THREE.CubeGeometry(4, 1, 2);
            var barn = new THREE.Mesh(barnGeometry, barnMaterial);
            barn.position.set(0, 0.5, -2)
            rootNode.add(barn)

            var sphereMaterial = new THREE.MeshBasicMaterial( {color: 0xffff00} );
            var sphereGeo = new THREE.SphereGeometry(0.4, 32, 32);
            var sun = new THREE.Mesh(sphereGeo, sphereMaterial);
            sun.position.set(5, 5, 3)
            rootNode.add(sun);
            
            scene.add(rootNode);
    
            addMouseHandler();
    
            run();
        }

        function loadModel(modelName) {
            const loader = new GLTFLoader().setPath( 'models/' );
            let modelNode = new THREE.Object3D();

            loader.load( modelName, function ( gltf ) {
                modelNode.add(gltf.scene);
            } );

            return modelNode;
        }

        function loadMultipleModels(rootNode, modelName, scale, positions) {
            for (let i = 0; i < positions.length; i++) {
                let modelNode = loadModel(modelName);
                modelNode.scale.set(scale, scale, scale);
                modelNode.position.set(positions[i][0],0,positions[i][1]);
                rootNode.add(modelNode);
            }
        }

        function loadCloudModels(rootNode, modelName, scale, positions) {
            for (let i = 0; i < positions.length; i++) {
                let modelNode = loadModel(modelName);
                modelNode.scale.set(scale, scale, scale);
                modelNode.position.set(positions[i][0],4,positions[i][1]);
                rootNode.add(modelNode);
            }
        }
        
        function run() {
            renderer.render(scene, camera);
            if (animating) {
                rootNode.rotation.y -= 0.01
            }
    
            requestAnimationFrame(run);
        }
    
        function addMouseHandler() {
            var dom = renderer.domElement;
            dom.addEventListener('mouseup', onMouseUp, false);
        }
    
        function onMouseUp(event) {
            event.preventDefault();
            animating = !animating;
        }
    
      </script>
 </body>
</html>